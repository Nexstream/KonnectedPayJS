/*** @license
 * Copyright 2016 Nexstream Sdn Bhd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
***/
"use strict";window.KonnectedPay=window.KonnectedPay||{},function(){var e="https://pay.appxtream.com",n=function(e){var n=function(n){if(null==e[n])throw new Error(n+" is required!")},r=function(n){if(!/^[0-9]+(\.?[0-9]+)$/.test(e[n]))throw new Error(n+" must be a valid number!")};n("merchantId"),n("clientSecret"),n("amount"),n("transId"),n("currencyCode"),n("fullName"),n("email"),n("userId"),r("amount")},r=function(e){for(var n=e.split("&"),r={},t=0;t<n.length;t++){var o=n[t].split("="),a=decodeURIComponent(o[0]);o.length>1?r[a]=decodeURIComponent(o[1]):r[a]=!0}return r},t=function(){var e=location.href.match(/^[^?]+\?([^#]+)/);return e?r(e[1]):{}},o=function(){var e=location.hash;return e?r(e.substr(1)):{}};KonnectedPay.VERSION="0.2.0-alpha",KonnectedPay.requestPayment=function(e,r){n(e);var t="https://pay.appxtream.com/payment?tranId="+encodeURIComponent(e.transId)+"&amount="+encodeURIComponent(e.amount)+"&currencyCode="+encodeURIComponent(e.currencyCode)+"&merchantId="+encodeURIComponent(e.merchantId)+"&device="+encodeURIComponent(navigator.userAgent)+"&os=browser&fullname="+encodeURIComponent(e.fullName)+"&email="+encodeURIComponent(e.email)+"&userId="+encodeURIComponent(e.userId);null!=e.rememberCard&&(t+="&rememberCard="+(e.rememberCard?"true":"false")),null!=e.returnUrl&&(t+="&return="+encodeURIComponent(e.returnUrl)),null!=e.responseMethod&&(t+="&returnMethod="+encodeURIComponent(e.responseMethod)),"_blank"!=r?location.assign(t):window.open(t,"_blank","menubar=no,toolbar=no,location=no,personalbar=no,directories=no")},KonnectedPay.getPaymentResults=function(e){var n;switch(e.toLowerCase()){case"get":n=t().KonnectedPayResp;break;case"hash":n=o().KonnectedPayResp;break;case"post":throw new Error("Please retrieve POST results on your server");default:throw new Error("Invalid method")}if(!n)return null;try{return JSON.parse(n)}catch(r){throw new Error("Invalid results: "+n)}},KonnectedPay.getTokens=function(n,r,t){var o=e+"/payment/token/"+encodeURIComponent(r)+"?clientSecret="+encodeURIComponent(n),a=new XMLHttpRequest;a.onreadystatechange=function(){switch(a.readyState){case 4:if(a.status<200||a.status>=300)t(!1,"Failed to retrieve tokens");else{try{var e=JSON.parse(this.responseText);if(null===e&&(e=[]),"object"!=typeof e||!(e instanceof Array))throw new Error("Response should be an array")}catch(n){return void t(!1,n&&n.message||"Invalid response from server")}t(!0,e.map(function(e){return{token:e.token,maskCard:e.maskCard,maskCardType:e.maskCardType}}))}}},a.open("GET",o),a.send()}}();
